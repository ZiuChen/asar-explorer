(function(){var e=Object.defineProperty,t=(e,t)=>()=>(e&&(t=e(e=0)),t),n=t=>{let n={};for(var r in t)e(n,r,{get:t[r],enumerable:!0});return n},r,i,a,o,s,c,l=t((()=>{r=e=>!!e&&typeof e==`object`&&!ArrayBuffer.isView(e)&&!(e instanceof ArrayBuffer)&&!(e instanceof Blob),i=e=>r(e)&&`files`in e&&r(e.files),a=`/`,o=(...e)=>e.filter(Boolean).join(a).replace(/\/+/g,a),s=e=>{let t=e.split(a).filter(Boolean);return t.pop(),t.join(a)||`.`},c=e=>{let t=e.split(a).filter(Boolean);return t[t.length-1]||``}})),u=n({extractAll:()=>S,extractFile:()=>v,getHeader:()=>y,getRawHeader:()=>b,listPackage:()=>x,readArchiveHeaderSync:()=>_,readFileAsText:()=>C,readFileAsUint8Array:()=>w}),d,f,p,m,h,g,_,v,y,b,x,S,C,w,T=t((()=>{l(),d=async e=>e instanceof ArrayBuffer?e:e instanceof Uint8Array?new Uint8Array(e).buffer:e instanceof Blob?e.arrayBuffer():new Blob([e]).arrayBuffer(),f=({basePath:e,metadata:t,filesOffset:n})=>Object.entries(t.files).flatMap(([t,r])=>i(r)?f({basePath:o(e,t),metadata:r,filesOffset:n}):{path:o(e,t),offset:Number(r.offset),size:r.size,fileOffset:n+8+Number(r.offset)}),p=({basePath:e,metadata:t,filesOffset:n})=>i(t)?Object.fromEntries(Object.entries(t.files).map(([t,r])=>[t,p({basePath:o(e,t),metadata:r,filesOffset:n})])):{path:e,offset:Number(t.offset),size:t.size,fileOffset:n+8+Number(t.offset)},m=({flat:e,header:t,filesOffset:n})=>e?f({metadata:t,basePath:`/`,filesOffset:n}):p({metadata:t,basePath:`/`,filesOffset:n}),h=(e,t)=>{let n=e,r=t.split(a).filter(Boolean);for(let e of r)e!==`.`&&n&&(n=n.files?.[e]);return n},g=(e,t)=>{if(t=t.replace(/^\//,``),!t)return e;let n=c(t),r=h(e,s(t));return r.files||={},r.files[n]||(r.files[n]={}),r.files[n]},_=e=>{let t=new DataView(e),n=t.getUint32(4,!0),r=t.getInt32(12,!0),i=new Uint8Array(e,16,r),a=new TextDecoder(`utf-8`).decode(i);return{header:JSON.parse(a),headerSize:n}},v=async(e,t)=>{let n=await d(e),r=new DataView(n),i=r.getUint32(4,!0),a=r.getUint32(12,!0),o=n.slice(16,a+16),s=new TextDecoder(`utf-8`).decode(o),{offset:c,size:l}=g(JSON.parse(s),t);return n.slice(i+Number(c)+8,i+Number(c)+(l||0)+8)},y=async(e,t)=>{let n=await d(e),r=new DataView(n),i=r.getUint32(4,!0),a=r.getUint32(12,!0),o=n.slice(16,a+16),s=new TextDecoder(`utf-8`).decode(o),c=JSON.parse(s);return{headerSize:a,filesOffset:i,header:m({flat:t?.flat??!1,header:c,filesOffset:i})}},b=async e=>{let t=await d(e),n=new DataView(t).getUint32(12,!0),r=t.slice(16,n+16),i=new TextDecoder(`utf-8`).decode(r);return JSON.parse(i)},x=async e=>{let{header:t}=await y(e,{flat:!0});return t.map(e=>e.path)},S=async(e,t)=>{let n=await d(e),{header:r}=await y(n,{flat:t?.flat});if(t?.flat)return Object.fromEntries(await Promise.all(r.map(async({path:e})=>[e,await v(n,e)])));let i=async e=>Object.fromEntries(await Promise.all(Object.entries(e).map(async([e,t])=>`path`in t?[e,await v(n,t.path)]:[e,await i(t)])));return i(r)},C=async(e,t)=>{let n=await v(e,t);return new TextDecoder(`utf-8`).decode(n)},w=async(e,t)=>{let n=await v(e,t);return new Uint8Array(n)}}));T();let E=(e,t)=>e+(t-e%t)%t;var D=class{constructor(e){this.payload=e.header,this.dataView=new DataView(e.header.buffer,e.header.byteOffset,e.header.byteLength),this.payloadOffset=e.headerSize,this.readIndex=0,this.endIndex=e.getPayloadSize()}readBool(){return this.readInt()!==0}readInt(){return this.readBytesAsNumber(4,!0)}readUInt32(){return this.readBytesAsNumber(4,!1)}readFloat(){let e=this.getReadPayloadOffsetAndAdvance(4);return this.dataView.getFloat32(e,!0)}readDouble(){let e=this.getReadPayloadOffsetAndAdvance(8);return this.dataView.getFloat64(e,!0)}readString(){let e=this.readInt(),t=this.readBytes(e);return new TextDecoder(`utf-8`).decode(t)}readBytes(e){let t=this.getReadPayloadOffsetAndAdvance(e);return this.payload.slice(t,t+e)}readBytesAsNumber(e,t){let n=this.getReadPayloadOffsetAndAdvance(e);if(e===4)return t?this.dataView.getInt32(n,!0):this.dataView.getUint32(n,!0);throw Error(`Unsupported size: ${e}`)}getReadPayloadOffsetAndAdvance(e){if(e>this.endIndex-this.readIndex)throw this.readIndex=this.endIndex,Error(`Failed to read data with length of `+e);let t=this.payloadOffset+this.readIndex;return this.advance(e),t}advance(e){let t=E(e,4);this.endIndex-this.readIndex<t?this.readIndex=this.endIndex:this.readIndex+=t}},O=class{constructor(e){e?(this.header=e,this.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength),this.headerSize=e.length-this.getPayloadSize(),this.capacityAfterHeader=9007199254740992,this.writeOffset=0,this.headerSize>e.length&&(this.headerSize=0),this.headerSize!==E(this.headerSize,4)&&(this.headerSize=0),this.headerSize===0&&(this.header=new Uint8Array,this.dataView=new DataView(this.header.buffer))):(this.header=new Uint8Array,this.dataView=new DataView(this.header.buffer),this.headerSize=4,this.capacityAfterHeader=0,this.writeOffset=0,this.resize(64),this.setPayloadSize(0))}createIterator(){return new D(this)}toBuffer(){return this.header.slice(0,this.headerSize+this.getPayloadSize())}writeBool(e){return this.writeInt(e?1:0)}writeInt(e){return this.writeNumber(e,4,!0)}writeUInt32(e){return this.writeNumber(e,4,!1)}writeFloat(e){let t=E(4,4),n=this.writeOffset+t;return n>this.capacityAfterHeader&&this.resize(Math.max(this.capacityAfterHeader*2,n)),this.dataView.setFloat32(this.headerSize+this.writeOffset,e,!0),this.fillZeros(4,t),this.setPayloadSize(n),this.writeOffset=n,!0}writeDouble(e){let t=E(8,4),n=this.writeOffset+t;return n>this.capacityAfterHeader&&this.resize(Math.max(this.capacityAfterHeader*2,n)),this.dataView.setFloat64(this.headerSize+this.writeOffset,e,!0),this.fillZeros(8,t),this.setPayloadSize(n),this.writeOffset=n,!0}writeString(e){let t=new TextEncoder().encode(e),n=t.length;return this.writeInt(n)?this.writeBytes(t,n):!1}setPayloadSize(e){this.dataView.setUint32(0,e,!0)}getPayloadSize(){return this.header.length<4?0:this.dataView.getUint32(0,!0)}writeNumber(e,t,n){let r=E(t,4),i=this.writeOffset+r;return i>this.capacityAfterHeader&&this.resize(Math.max(this.capacityAfterHeader*2,i)),n?this.dataView.setInt32(this.headerSize+this.writeOffset,e,!0):this.dataView.setUint32(this.headerSize+this.writeOffset,e,!0),this.fillZeros(t,r),this.setPayloadSize(i),this.writeOffset=i,!0}writeBytes(e,t){let n=E(t,4),r=this.writeOffset+n;return r>this.capacityAfterHeader&&this.resize(Math.max(this.capacityAfterHeader*2,r)),this.header.set(e,this.headerSize+this.writeOffset),this.fillZeros(t,n),this.setPayloadSize(r),this.writeOffset=r,!0}fillZeros(e,t){let n=this.headerSize+this.writeOffset+e;for(let e=n;e<this.headerSize+this.writeOffset+t;e++)this.header[e]=0}resize(e){e=E(e,64);let t=new Uint8Array(this.headerSize+e);t.set(this.header),this.header=t,this.dataView=new DataView(t.buffer,t.byteOffset,t.byteLength),this.capacityAfterHeader=e}};let k=()=>new O;l();let A=e=>{let t={};for(let[n,r]of Object.entries(e)){let e=t,i=n.split(a).filter(Boolean),o=i.pop();for(let t of i)e=e[t]=e[t]??{};e[o]=r}return t},j=e=>Object.entries(e).reduce(({files:e},[t,n])=>({files:{...e,[t]:r(n)?j(n):n}}),{files:{}}),M=async e=>{if(e instanceof Uint8Array)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(e instanceof Blob){let t=await e.arrayBuffer();return new Uint8Array(t)}return new TextEncoder().encode(e)},N=async e=>{let t={files:{}};for(let[n,i]of Object.entries(e.files))if(r(i)&&`files`in i)t.files[n]=await N(i);else{let e=await M(i);t.files[n]={size:e.length}}return t},P=e=>{let t=(e,n)=>Object.entries(e.files).reduce(([{files:e},n],[r,a])=>{let[o,s]=i(a)?t(a,n):[{size:a.size||0,offset:n},(Number(n)+(a.size||0)).toString()];return[{files:{...e,[r]:o}},s]},[{files:{}},n||`0`]);return t(e,`0`)[0]},F=async e=>P(await N(j(e))),I=async e=>{let t=[];for(let[,n]of Object.entries(e))if(r(n)){let e=await I(n);t.push(...e)}else t.push(await M(n));return t},L=async(e,t)=>{let n=t?.flat?A(e):e,r=await F(n),i=k();i.writeString(JSON.stringify(r));let a=i.toBuffer(),o=k();o.writeUInt32(a.length);let s=o.toBuffer(),c=await I(n),l=s.length+a.length+c.reduce((e,t)=>e+t.length,0),u=new Uint8Array(l),d=0;u.set(s,d),d+=s.length,u.set(a,d),d+=a.length;for(let e of c)u.set(e,d),d+=e.length;return u},R=async(e,t)=>{let{getHeader:n,extractFile:r}=await Promise.resolve().then(()=>(T(),u)),{header:i}=await n(e,{flat:!0}),a=i,o={};for(let{path:t}of a){let n=await r(e,t),i=t.replace(/^\//,``);o[i]=new Uint8Array(n)}for(let[e,n]of Object.entries(t)){let t=e.replace(/^\//,``);o[t]=n}return L(o,{flat:!0})};self.onmessage=async e=>{let t=e.data;try{switch(t.type){case`parseHeader`:{let{header:e,filesOffset:n}=await y(t.data,{flat:!0}),r={type:`parseHeader`,id:t.id,result:{files:e,filesOffset:n}};self.postMessage(r);break}case`extractFile`:{let e=await v(t.data,t.path),n={type:`extractFile`,id:t.id,result:e};self.postMessage(n,{transfer:[e]});break}case`extractFiles`:{let e={},n=[];for(let r of t.paths){let i=await v(t.data,r);e[r]=i,n.push(i)}let r={type:`extractFiles`,id:t.id,result:e};self.postMessage(r,{transfer:n});break}case`modifyPackage`:{let e=await R(t.data,t.modifications),n={type:`modifyPackage`,id:t.id,result:e};self.postMessage(n,{transfer:[e.buffer]});break}}}catch(e){let n={type:`error`,id:t.id,error:e instanceof Error?e.message:String(e)};self.postMessage(n)}}})();
//# sourceMappingURL=worker-CT2nJRkM.js.map